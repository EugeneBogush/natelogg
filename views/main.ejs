<!DOCTYPE html>
<html>
    <head>
        <title>NateLogg</title>
        <style>
            html, body {
                height: 100%;
                width: 100%;
                margin: 0;
            }
            pre {
                margin: 2px 0;
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            label {
                color: #03168c;
                cursor: pointer;
            }

            select {
                width: 100%;
            }

            #main {
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            #left-panel {
                float: left;
                width: 200px;
                height: 100%;
                background-color: #000;
                border-right: #838181 4px solid;
                font-family: monospace;
                font-size: 10px;
                color: #fff;
            }

            .left-panel-header {
                display: inline-block;
                height: 32px;
                width: 100%;
                text-align: center;
                line-height: 32px;
                font-size: 12px;
                font-weight: bold;
                background-color: #222;
            }

            .panel-section-body {
                padding: 5px;
            }

            #right-panel {
                width: auto;
                height: 100%;
                overflow: hidden;
            }

            #shell {
                width: 100%;
                height: 100%;
                font-size: 12px;
                background-color: black;
                color: white;
                overflow-y: auto;
            }
        </style>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket          = io();
            var historyLength   = 0;
            var maxHistoryLines = 1000;
            var shell;

            window.onload = function() {
                shell = document.getElementById('shell');
                document.getElementById('font-size').onchange = function() {
                    shell.style.fontSize = this.value + 'px';
                };
                document.getElementById('max-history-lines').onchange = function() {
                    var val = parseInt(this.value);
                    if(val === 0) {
                        maxHistoryLines = Infinity;
                    }else {
                        maxHistoryLines = val;
                    }
                };
            };

            function toggleLog(el, log) {
                var checked = el.checked;
                socket.emit('toggleLog', {
                    log     : log,
                    enabled : checked
                });
            }

            socket.on('logData', function(data) {
                var scrollAtBottom = (shell.scrollHeight == (shell.offsetHeight + shell.scrollTop)) ? true : false;
                var pre = document.createElement('pre');
                var lines = shell.getElementsByTagName('pre');
                var removeLength;
                var n;

                if(historyLength >= maxHistoryLines) {
                    removeLength = historyLength - maxHistoryLines;
                    for(n=0; n<=removeLength; n++) {
                        shell.removeChild(shell.children[0]);
                        historyLength--;
                    }
                }
                pre.innerHTML=data;
                shell.appendChild(pre);
                historyLength++;

                if(scrollAtBottom) {
                    shell.scrollTop = shell.scrollHeight;
                }
            });
        </script>
    </head>
    <body>
        <div id="main">
            <div id="left-panel">
                <span class="left-panel-header">
                    Logs
                </span>
                <div class="panel-section-body">
                    <table>
                    <% for(var i=0; i<logs.length; i++) { %>
                        <tr>
                            <td><input type="checkbox" onclick="toggleLog(this, '<%= logs[i] %>')" /></td>
                            <td><%= logs[i] %></td>
                        </tr>
                    <% } %>
                    </table>
                </div>
                <span class="left-panel-header">
                    Formatters
                </span>
                <div class="panel-section-body">
                    <table>
                        <tr>
                            <td><input type="checkbox" /></td>
                            <td>Bunyan</td>
                            <td><label>(options)</label></td>
                        </tr>
                    </table>
                </div>
                <span class="left-panel-header">
                    Settings
                </span>
                <div class="panel-section-body">
                    <table>
                        <tr>
                            <td>Font Size:</td>
                            <td>
                                <select id="font-size">
                                    <option value="8">8</option>
                                    <option value="10">10</option>
                                    <option value="12" selected>12</option>
                                    <option value="14">14</option>
                                    <option value="16">16</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>History Max Lines:</td>
                            <td>
                                <select id="max-history-lines">
                                    <option value="0">&infin;</option>
                                    <option value="100">100</option>
                                    <option value="1000" selected>1,000</option>
                                    <option value="10000">10,000</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="right-panel">
                <div id="shell"></div>
            </div>
        </div>
    </body>
</html>
